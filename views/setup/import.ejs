<div class="import-screen">
    <div class="screen-header text-center mb-5">
        <h2 class="screen-title">Import Your Current Bylaws</h2>
        <p class="screen-subtitle">We'll parse your document and set up the system</p>
    </div>

    <form id="importForm" class="setup-form" novalidate>
        <!-- CSRF Token -->
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">

        <!-- Import Method Tabs -->
        <ul class="nav nav-pills nav-justified mb-4" role="tablist">
            <li class="nav-item" role="presentation">
                <button
                    class="nav-link active"
                    id="upload-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#upload-panel"
                    type="button"
                >
                    <i class="bi bi-cloud-upload"></i>
                    Upload File
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button
                    class="nav-link"
                    id="google-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#google-panel"
                    type="button"
                >
                    <i class="bi bi-google"></i>
                    Google Docs
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Upload File Panel -->
            <div class="tab-pane fade show active" id="upload-panel" role="tabpanel">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-zone" id="uploadZone">
                        <input
                            type="file"
                            id="documentFile"
                            name="document"
                            accept=".docx,.doc,application/vnd.openxmlformats-officedocument.wordprocessingml.document"
                            hidden
                        >
                        <div class="upload-icon">
                            <i class="bi bi-cloud-arrow-up"></i>
                        </div>
                        <h4>Drag and drop your bylaws document</h4>
                        <p class="text-muted">or click to browse</p>
                        <button type="button" class="btn btn-primary mt-3" id="browseBtn">
                            <i class="bi bi-folder2-open"></i>
                            Browse Files
                        </button>
                        <p class="mt-3 small text-muted">
                            <i class="bi bi-info-circle"></i>
                            Supported formats: .docx (Word Document) â€¢ Max 10MB
                        </p>
                    </div>

                    <!-- File Preview -->
                    <div class="file-preview" id="filePreview" style="display: none;">
                        <div class="file-info">
                            <div class="file-icon">
                                <i class="bi bi-file-earmark-word"></i>
                            </div>
                            <div class="file-details">
                                <h6 id="fileName">document.docx</h6>
                                <p class="text-muted small" id="fileSize">0 KB</p>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-danger" id="removeFile">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Google Docs Panel -->
            <div class="tab-pane fade" id="google-panel" role="tabpanel">
                <div class="google-import-area">
                    <div class="google-icon mb-4">
                        <i class="bi bi-google"></i>
                    </div>
                    <div class="mb-4">
                        <label for="googleDocUrl" class="form-label">
                            <i class="bi bi-link-45deg"></i>
                            Google Docs Link
                        </label>
                        <input
                            type="url"
                            class="form-control form-control-lg"
                            id="googleDocUrl"
                            name="google_doc_url"
                            placeholder="https://docs.google.com/document/d/..."
                        >
                        <div class="form-text">
                            Paste the shareable link to your Google Doc. Make sure it's set to "Anyone with the link can view"
                        </div>
                        <div class="invalid-feedback">
                            Please enter a valid Google Docs URL
                        </div>
                    </div>

                    <div class="alert alert-info">
                        <h6 class="alert-heading">
                            <i class="bi bi-question-circle"></i>
                            How to get the link
                        </h6>
                        <ol class="mb-0 small">
                            <li>Open your bylaws document in Google Docs</li>
                            <li>Click the "Share" button in the top-right</li>
                            <li>Change access to "Anyone with the link"</li>
                            <li>Copy the link and paste it above</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <!-- Parsing Options -->
        <div class="parsing-options mt-5" id="parsingOptions" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-sliders"></i>
                        Import Options
                    </h5>
                </div>
                <div class="card-body">
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="autoDetectStructure" name="auto_detect_structure" checked>
                        <label class="form-check-label" for="autoDetectStructure">
                            <strong>Automatically detect section structure</strong>
                            <div class="form-text">We'll try to identify Articles, Sections, and their numbers</div>
                        </label>
                    </div>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="preserveFormatting" name="preserve_formatting">
                        <label class="form-check-label" for="preserveFormatting">
                            <strong>Preserve text formatting</strong>
                            <div class="form-text">Keep bold, italic, and other text styles</div>
                        </label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="createInitialVersion" name="create_initial_version" checked>
                        <label class="form-check-label" for="createInitialVersion">
                            <strong>Create version 1.0</strong>
                            <div class="form-text">This import will be marked as the first official version</div>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Document Preview (after parsing) -->
        <div class="document-preview mt-4" id="documentPreview" style="display: none;">
            <div class="card border-success">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-check-circle"></i>
                        Document Parsed Successfully
                    </h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">
                        We found <strong id="sectionCount">0</strong> sections in your document.
                        Review and edit if needed:
                    </p>
                    <div id="sectionsList" class="sections-preview">
                        <!-- Sections will be listed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Edit Template -->
        <template id="sectionPreviewTemplate">
            <div class="section-preview-item">
                <div class="section-preview-header">
                    <input
                        type="text"
                        class="form-control form-control-sm section-title"
                        placeholder="Section title"
                    >
                    <input
                        type="text"
                        class="form-control form-control-sm section-number"
                        placeholder="Number"
                        style="width: 100px;"
                    >
                </div>
                <div class="section-preview-content">
                    <textarea
                        class="form-control form-control-sm section-text"
                        rows="2"
                        readonly
                    ></textarea>
                </div>
            </div>
        </template>

        <!-- Skip Import Option -->
        <div class="skip-import-option mt-4">
            <div class="alert alert-secondary">
                <i class="bi bi-info-circle"></i>
                Don't have your document ready?
                <a href="#" id="skipImportLink">Skip this step and add it later</a>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
            <a href="/setup/workflow" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i>
                Back
            </a>
            <button type="submit" class="btn btn-success btn-lg" id="completeSetupBtn">
                <i class="bi bi-check-circle"></i>
                Complete Setup
            </button>
        </div>

        <!-- Loading Overlay -->
        <div class="form-loading" id="formLoading" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Processing...</span>
            </div>
            <p class="mt-2" id="loadingMessage">Uploading your document...</p>
        </div>
    </form>
</div>

<script>
// Initialize import form
document.addEventListener('DOMContentLoaded', function() {
    if (typeof SetupWizard !== 'undefined') {
        SetupWizard.initImportForm();
    }
});
</script>
