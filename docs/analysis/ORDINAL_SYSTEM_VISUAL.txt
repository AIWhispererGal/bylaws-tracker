# Ordinal System Visual Explanation

## Two Separate Ordering Systems

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DOCUMENT_SECTIONS TABLE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Each section has TWO ordering fields:                              â”‚
â”‚                                                                     â”‚
â”‚  1. ORDINAL        = Position among siblings (1, 2, 3...)          â”‚
â”‚  2. DOCUMENT_ORDER = Sequential position in document (1, 2, 3...)  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


## Example: Simple Bylaws Document

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Visual Structure          â”‚ ordinal â”‚ document_order â”‚ depth â”‚ parent  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Article I                 â”‚    1    â”‚       1        â”‚   0   â”‚  NULL   â”‚
â”‚   Section 1               â”‚    1    â”‚       2        â”‚   1   â”‚ Art I   â”‚
â”‚   Section 2               â”‚    2    â”‚       3        â”‚   1   â”‚ Art I   â”‚
â”‚   Section 3               â”‚    3    â”‚       4        â”‚   1   â”‚ Art I   â”‚
â”‚ Article II                â”‚    2    â”‚       5        â”‚   0   â”‚  NULL   â”‚
â”‚   Section 1               â”‚    1    â”‚       6        â”‚   1   â”‚ Art II  â”‚
â”‚     Subsection A          â”‚    1    â”‚       7        â”‚   2   â”‚ Sec 1   â”‚
â”‚     Subsection B          â”‚    2    â”‚       8        â”‚   2   â”‚ Sec 1   â”‚
â”‚   Section 2               â”‚    2    â”‚       9        â”‚   1   â”‚ Art II  â”‚
â”‚ Article III               â”‚    3    â”‚      10        â”‚   0   â”‚  NULL   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

KEY OBSERVATIONS:
  â€¢ ORDINAL resets for each parent:
    - Article I, II, III have ordinals 1, 2, 3 (same parent: NULL)
    - Article I's sections have ordinals 1, 2, 3 (same parent: Article I)
    - Article II's sections have ordinals 1, 2 (same parent: Article II)

  â€¢ DOCUMENT_ORDER is globally sequential:
    - Never resets, always increments: 1, 2, 3, 4, 5...
    - Matches the order sections appear in original document


## What Happens During INDENT Operation

BEFORE INDENT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Article I (ord=1, doc_ord=1)            â”‚
â”‚   Section 1 (ord=1, doc_ord=2)          â”‚
â”‚   Section 2 (ord=2, doc_ord=3) â† INDENT â”‚
â”‚   Section 3 (ord=3, doc_ord=4)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AFTER INDENT (Section 2 becomes child of Section 1):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Article I (ord=1, doc_ord=1)            â”‚
â”‚   Section 1 (ord=1, doc_ord=2)          â”‚
â”‚     Section 2 (ord=1, doc_ord=3) âœ“      â”‚
â”‚   Section 3 (ord=2, doc_ord=4) âœ“        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CHANGES:
  1. Section 2:
     â€¢ parent_section_id: Article I â†’ Section 1
     â€¢ ordinal: 2 â†’ 1 (first child of Section 1)
     â€¢ depth: 1 â†’ 2
     â€¢ document_order: 3 (UNCHANGED)

  2. Section 3:
     â€¢ ordinal: 3 â†’ 2 (gap closed)
     â€¢ Everything else unchanged

CRITICAL: Ordinal must be â‰¥ 1 (enforced by CHECK constraint)


## What Happens During DEDENT Operation

BEFORE DEDENT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Article I (ord=1, doc_ord=1)            â”‚
â”‚   Section 1 (ord=1, doc_ord=2)          â”‚
â”‚     Subsection A (ord=1, doc_ord=3)     â”‚
â”‚     Subsection B (ord=2, doc_ord=4) â† DEDENT
â”‚   Section 2 (ord=2, doc_ord=5)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AFTER DEDENT (Subsection B becomes sibling of Section 1):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Article I (ord=1, doc_ord=1)            â”‚
â”‚   Section 1 (ord=1, doc_ord=2)          â”‚
â”‚     Subsection A (ord=1, doc_ord=3)     â”‚
â”‚   Subsection B (ord=2, doc_ord=4) âœ“     â”‚
â”‚   Section 2 (ord=3, doc_ord=5) âœ“        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CHANGES:
  1. Subsection B:
     â€¢ parent_section_id: Section 1 â†’ Article I
     â€¢ ordinal: 2 â†’ 2 (inserted after Section 1)
     â€¢ depth: 2 â†’ 1
     â€¢ document_order: 4 (UNCHANGED)

  2. Section 2:
     â€¢ ordinal: 2 â†’ 3 (space created)
     â€¢ Everything else unchanged


## What Happens During MOVE UP Operation

BEFORE MOVE UP:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Article I (ord=1, doc_ord=1)            â”‚
â”‚   Section 1 (ord=1, doc_ord=2)          â”‚
â”‚   Section 2 (ord=2, doc_ord=3) â† MOVE UPâ”‚
â”‚   Section 3 (ord=3, doc_ord=4)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AFTER MOVE UP (Section 2 swaps with Section 1):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Article I (ord=1, doc_ord=1)            â”‚
â”‚   Section 2 (ord=1, doc_ord=3) âœ“        â”‚
â”‚   Section 1 (ord=2, doc_ord=2) âœ“        â”‚
â”‚   Section 3 (ord=3, doc_ord=4)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CHANGES (SWAP):
  â€¢ Section 1: ordinal 1 â†’ 2
  â€¢ Section 2: ordinal 2 â†’ 1
  â€¢ document_order UNCHANGED (still reflects parse order)
  â€¢ Section 3 unaffected


## Why Operations Are Failing

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ THE PROBLEM                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚ Database Constraint:                                             â”‚
â”‚   CHECK (ordinal > 0)  â† Must be positive integer               â”‚
â”‚                                                                  â”‚
â”‚ Missing Functions:                                               â”‚
â”‚   âŒ increment_sibling_ordinals() - Not in database             â”‚
â”‚   âŒ decrement_sibling_ordinals() - Not in database             â”‚
â”‚   âŒ swap_sibling_ordinals()      - Not in database             â”‚
â”‚                                                                  â”‚
â”‚ Code Attempts:                                                   â”‚
â”‚   âŒ supabaseService.sql`ordinal + 1`  â† Invalid API            â”‚
â”‚                                                                  â”‚
â”‚ Result:                                                          â”‚
â”‚   â†’ "function does not exist" errors                             â”‚
â”‚   â†’ "violates check constraint" errors                           â”‚
â”‚   â†’ Operations fail, hierarchy breaks                            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


## How RPC Functions Fix This

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RPC FUNCTION: decrement_sibling_ordinals()                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚ Purpose: Close gaps after removing a section                     â”‚
â”‚                                                                  â”‚
â”‚ Example:                                                         â”‚
â”‚   BEFORE: ordinals = [1, 2, â›”, 4, 5]  (3 was removed)          â”‚
â”‚   CALL: decrement_sibling_ordinals(parent_id, 2, 1)             â”‚
â”‚   AFTER:  ordinals = [1, 2, 3, 4]  âœ“                            â”‚
â”‚                                                                  â”‚
â”‚ SQL:                                                             â”‚
â”‚   UPDATE document_sections                                       â”‚
â”‚   SET ordinal = ordinal - 1                                      â”‚
â”‚   WHERE parent_section_id = p_parent_id                          â”‚
â”‚     AND ordinal > p_start_ordinal;                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RPC FUNCTION: increment_sibling_ordinals()                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚ Purpose: Make space for inserting a section                      â”‚
â”‚                                                                  â”‚
â”‚ Example:                                                         â”‚
â”‚   BEFORE: ordinals = [1, 2, 3, 4]                               â”‚
â”‚   CALL: increment_sibling_ordinals(parent_id, 3, 1)             â”‚
â”‚   AFTER:  ordinals = [1, 2, â¬œ, 4, 5]  (space at 3)             â”‚
â”‚                                                                  â”‚
â”‚ SQL:                                                             â”‚
â”‚   UPDATE document_sections                                       â”‚
â”‚   SET ordinal = ordinal + 1                                      â”‚
â”‚   WHERE parent_section_id = p_parent_id                          â”‚
â”‚     AND ordinal >= p_start_ordinal;                              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RPC FUNCTION: swap_sibling_ordinals()                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚ Purpose: Swap two sections' ordinals (for move up/down)          â”‚
â”‚                                                                  â”‚
â”‚ Example:                                                         â”‚
â”‚   BEFORE: Section A (ord=2), Section B (ord=3)                  â”‚
â”‚   CALL: swap_sibling_ordinals(A.id, B.id)                       â”‚
â”‚   AFTER:  Section A (ord=3), Section B (ord=2)  âœ“               â”‚
â”‚                                                                  â”‚
â”‚ SQL:                                                             â”‚
â”‚   v_ord_1 := SELECT ordinal FROM ... WHERE id = id_1;           â”‚
â”‚   v_ord_2 := SELECT ordinal FROM ... WHERE id = id_2;           â”‚
â”‚   UPDATE ... SET ordinal = v_ord_2 WHERE id = id_1;             â”‚
â”‚   UPDATE ... SET ordinal = v_ord_1 WHERE id = id_2;             â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


## Common Failure Scenarios

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SCENARIO 1: Indent without previous sibling                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Structure:                                                       â”‚
â”‚   Article I                                                      â”‚
â”‚     Section 1 â† Try to indent                                    â”‚
â”‚                                                                  â”‚
â”‚ Error: "Cannot indent: no earlier sibling"                      â”‚
â”‚ Reason: No previous sibling to become parent                     â”‚
â”‚ Status: âœ… CORRECT BEHAVIOR (by design)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SCENARIO 2: Indent with RPC missing                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Structure:                                                       â”‚
â”‚   Article I                                                      â”‚
â”‚     Section 1                                                    â”‚
â”‚     Section 2 â† Try to indent                                    â”‚
â”‚                                                                  â”‚
â”‚ Error: "function decrement_sibling_ordinals does not exist"     â”‚
â”‚ Reason: Migration 008 not deployed                               â”‚
â”‚ Status: ğŸ”´ BUG - Need to deploy RPC functions                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SCENARIO 3: Ordinal calculation error                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Code:                                                            â”‚
â”‚   const newOrdinal = (childCount || 0) + 1;                     â”‚
â”‚                                                                  â”‚
â”‚ If childCount = NULL:                                            â”‚
â”‚   newOrdinal = (NULL || 0) + 1 = 0 + 1 = 1  âœ…                  â”‚
â”‚                                                                  â”‚
â”‚ If childCount = 3:                                               â”‚
â”‚   newOrdinal = 3 + 1 = 4  âœ…                                     â”‚
â”‚                                                                  â”‚
â”‚ Status: âœ… CODE CORRECT (coalesce works)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SCENARIO 4: Invalid Supabase API                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Code (BROKEN):                                                   â”‚
â”‚   .update({ ordinal: supabaseService.sql`ordinal + 1` })        â”‚
â”‚                                                                  â”‚
â”‚ Error: "supabaseService.sql is not a function"                  â”‚
â”‚ Reason: Supabase JS client doesn't have .sql() method           â”‚
â”‚ Fix: Use RPC function instead                                   â”‚
â”‚ Status: ğŸ”´ BUG - Replace with proper RPC call                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


## Summary

ORDINAL SYSTEM:
  âœ“ Uses 1-based indexing (ordinal starts at 1)
  âœ“ Ordinals are per-parent (siblings compete for ordinals)
  âœ“ Must be sequential (no gaps: 1, 2, 3, 4...)
  âœ“ Separate from document_order (parse sequence)

CURRENT BUGS:
  âœ— RPC functions not deployed
  âœ— Invalid Supabase API usage
  âœ— Move up/down not implemented

FIX PRIORITY:
  1. Deploy RPC functions (migration 008)
  2. Remove invalid .sql() calls
  3. Add move up/down endpoints
  4. Test all operations
